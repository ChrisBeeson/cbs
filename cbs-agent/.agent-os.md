# CBS Agent-OS: Cell-Based Development Workflow

This file defines how AI agents should work within the CBS framework, ensuring we always maintain biological isolation and cell-based thinking.

## Core Principles

### 1. Cell-Centric Thinking
- Always work within the context of specific cells
- Never think in terms of traditional files/modules
- Maintain biological isolation at all times

### 2. Bus-Only Communication
- Cells MUST ONLY communicate through the message bus
- No direct imports between cells
- No shared state between cells
- All data flows through typed messages

### 3. Application Context Awareness
- Always know which application we're working on
- Understand the cell ecosystem within that application
- Respect message contracts between cells

## Agent Commands

Commands available in `scripts/agent-os/`:

### Application Management
- `cbs-app-context <app_name>` - Set current application context

### Cell Development
- `cbs-cell-focus <cell_name>` - Focus on a specific cell
- `cbs-cell-list` - List cells in current application
- `cbs-cell-messages [cell_name]` - Show a cell's message contracts

### Development Workflow
- `cbs-work-start <app> <cell>` - Start working on a specific cell
- `cbs-work-start --status` - Show current work context

### Validation
- `cbs-validate-isolation` - Validate isolation (or `--app`, `--all`)

## Current Context

The agent should always maintain awareness of:

```bash
# Current application context
CURRENT_APP=""

# Current cell focus  
CURRENT_CELL=""

# Work mode (cell_focused, app_overview, integration_testing)
WORK_MODE="app_overview"
```

## Workflow Examples

### Starting Work on a Cell
```bash
# Set application context
cbs-app-context flutter_flow_web

# Focus on specific cell
cbs-cell-focus flow_ui

# Start working
cbs-work-start flutter_flow_web flow_ui
```

### Creating a New Cell
```bash
# Ensure we're in app context
cbs-app-context my_app

# Create new cell (use your project scaffolding)
# e.g., scripts or manual directory setup per examples

# Focus on the new cell
cbs-cell-focus user_service
```

### Message Contract Development
```bash
# Show current cell's message contracts
cbs-cell-messages user_service

# Validate isolation
cbs-validate-isolation
```

## Agent Behavior Rules

### When Working on Code
1. **Always check current context** before making changes
2. **Focus on one cell at a time** - no cross-cell edits
3. **Validate message contracts** before implementation
4. **Test in isolation first** before integration testing
5. **Update cell spec** when changing message contracts

### When Creating New Features
1. **Design message contracts first** in `ai/spec.md`
2. **Identify which cells need changes** 
3. **Work on cells one at a time**
4. **Test each cell independently**
5. **Validate bus-only communication**

### When Debugging
1. **Use correlation IDs** to trace message flows
2. **Check message contracts** for compatibility issues
3. **Validate cell isolation** - no direct dependencies
4. **Test with mock bus** before live integration

### When Refactoring
1. **Preserve message contracts** unless explicitly changing
2. **Refactor one cell at a time**
3. **Maintain backward compatibility** when possible
4. **Update specs** to reflect changes
5. **Test all affected message flows**

## Enforcement

The agent-os system enforces CBS principles through:

### Automatic Validation
- Pre-commit hooks validate cell isolation
- Message contract validation on changes
- Bus-only communication verification

### Context Management
- Current app/cell context tracking
- Work mode enforcement
- Cell-focused file operations

### Guided Workflows
- Step-by-step cell development
- Message-first design process
- Isolation-preserving refactoring

## Integration with Development Tools

Refer to `docs/agent-os-guide.md` for IDE, hooks, and CI examples.

## Getting Started

1. **Read [The CBS Way](../docs/the-cbs-way.md)** to understand the paradigm
2. **Set up your first application context**:
   ```bash
   cbs-app-context my_first_app
   ```
3. **Create your first cell**:
   ```bash
   # Use your chosen scaffolding or create directories per examples
   mkdir -p applications/my_first_app/cells/greeter/{ai,lib,test}
   ```
4. **Start cell-focused development**:
   ```bash
   cbs-work-start my_first_app greeter
   ```

Remember: CBS is about biological isolation. Think in cells, communicate through messages, trust the bus! ðŸ§¬
